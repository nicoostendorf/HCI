<html>
<head>
<title>StackOverflow - Chat</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="style.css" media="screen" />
<link rel="stylesheet" type="text/css" href="chat_style.css" media="screen" />
<script>

var chatison = true;
	
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}


async  function myLoop () {           

	while(chatison){
		var name = "Student";
		SQLite(name,"");
		await sleep(500);
	}

}

function init() {
	document.getElementById('MessageBox').addEventListener("keydown", function(event) {
	if (event.which)
	  if (event.which == 13 && document.getElementById('MessageBox').value != ""){
		sende();
	  }
	})
	document.getElementById('MessageBox').focus();
	myLoop()
}

function sende(){
	var message = document.getElementById('MessageBox').value;
	var name = "Student";
	if (message.localeCompare("End") == 0)chatison = true;
	SQLite(name, message);
this.scrollTop = this.scrollHeight;

document.getElementById('MessageBox').value = "";
}

//Lässt sich theoretisch als Gruppen-Chat nutzen, wenn Datenbank und Apache-Server online sind (z.B. über XAMPP)
function SQLite(name, message) {
		if (window.XMLHttpRequest) {
			xmlhttp = new XMLHttpRequest();
		} else {
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				if (this.responseText != "AKTUELL"){
					document.getElementById("Tabelle").innerHTML = this.responseText;
					console.log(this.responseText);
				}
			}
		};
		xmlhttp.open("GET","getdata.php?a="+message+" &b="+ name +" &n=1",true);
		xmlhttp.send();
}


</script>
</head>
 <BODY onload="init()"  >
 
	<div class="grid-container">
	  <div class="grid-item item1" >
					<img src="Web.png" style="height:97%;">
					<br>
	  </div>
	  
	  <div class="grid-item item2">
			<a href="LoginSTUDENT.html" title="login_page"><button id="logout" type="submit" name="submit">STUDENT Logout</button></a>
	  </div>
	  
	  <div class="grid-item item3">
	  	<a href="firstpageSTUDENT.html"> <button class="exitButton" onclick="sende()" type="button">EXIT CHAT</button></a>
		 <div class="container">
		<div class="row">
			<div class="chat">
			 <div class="panel-body">
				<div  id="Tabelle" >
					<div class='container'  >
						<div class='row message-yours'><p class='text-muted'>Student:</p><p>Nachricht 1</p> </div>
						<div class='row message-other'><p class='text-muted'>Tutor:</p><p>Nachricht 2</p></div>
					
					</div>
				</div>
				  </div>
					  <div class="panel-footer">
						 <div class="input-group">
						  <input type="text" class="textfield" id="MessageBox">
							<button class="sendButton" onclick="sende()" type="button">Senden</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	  </div>
	</div>
</div>	
</body>
</html>
